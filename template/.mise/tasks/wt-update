#!/bin/bash
#MISE description="Fetch all remotes and fast-forward the main branch"

set -euo pipefail

if ! git remote | grep -q .; then
  echo "No remotes configured. Nothing to update." >&2
  exit 1
fi

git fetch --all --quiet

# Fast-forward main inside its worktree
if git -C main merge --ff-only origin/main 2>/dev/null; then
  echo "Updated main to $(git -C main rev-parse --short HEAD)"
else
  echo "Could not fast-forward main (diverged or worktree missing)." >&2
  echo "  Resolve manually: cd main && git pull"
  exit 1
fi
