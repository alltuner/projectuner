#!/bin/bash
#MISE description="Remove a git worktree and its local branch"

set -euo pipefail

BRANCH="${1:?Usage: mise run wt-rm <branch-name>}"

if [ "$BRANCH" = "main" ]; then
  echo "Error: refusing to remove the main worktree." >&2
  exit 1
fi

git worktree remove "$BRANCH"

if ! git branch -d "$BRANCH" 2>/dev/null; then
  echo "Worktree removed but branch '$BRANCH' has unmerged changes."
  echo "  To delete it anyway: git branch -D $BRANCH"
else
  echo "Removed worktree and branch '$BRANCH'"
fi
